# MTProxy å¢å¼ºç‰ˆç®¡ç†è„šæœ¬

æ”¯æŒå¤šç§Linuxå‘è¡Œç‰ˆçš„MTProxyä¸€é”®å®‰è£…å’Œç®¡ç†è„šæœ¬ï¼ŒåŒ…å«å®Œæ•´çš„æ£€æŸ¥ã€è¯Šæ–­å’Œä¿®å¤åŠŸèƒ½ã€‚

## ğŸ¯ æ”¯æŒçš„ç³»ç»Ÿ

- âœ… **Alpine Linux** (v3.19+)
- âœ… **AlmaLinux/RHEL/CentOS** (7+)
- âœ… **Debian/Ubuntu** (18.04+)

## ğŸ“¦ è„šæœ¬è¯´æ˜

### `mtproxy.sh` - å¢å¼ºç‰ˆç®¡ç†è„šæœ¬
æä¾›å®Œæ•´çš„å®‰è£…ã€é…ç½®ã€ç®¡ç†å’Œç›‘æ§åŠŸèƒ½ï¼ŒåŒ…å«è¿›ç¨‹ç¨³å®šæ€§è§£å†³æ–¹æ¡ˆã€‚

```bash
# ä¸‹è½½è„šæœ¬å¹¶è¿è¡Œ
wget https://raw.githubusercontent.com/your-repo/mtproxy/main/mtproxy.sh && chmod +x mtproxy.sh && ./mtproxy.sh

# å‘½ä»¤è¡Œä½¿ç”¨
./mtproxy.sh install    # å®‰è£…
./mtproxy.sh start      # å¯åŠ¨
./mtproxy.sh stop       # åœæ­¢
./mtproxy.sh restart    # é‡å¯
./mtproxy.sh status     # æŸ¥çœ‹çŠ¶æ€
./mtproxy.sh monitor    # è¿›ç¨‹ç›‘æ§
./mtproxy.sh health     # å¥åº·æ£€æŸ¥
./mtproxy.sh uninstall  # å¸è½½
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ä¸€é”®å®‰è£…ï¼ˆæ¨èï¼‰
```bash
# ä¸‹è½½å¹¶è¿è¡Œ
wget https://raw.githubusercontent.com/your-repo/mtproxy/main/mtproxy.sh
chmod +x mtproxy.sh
./mtproxy.sh

# æˆ–ç›´æ¥è¿è¡Œ
bash <(curl -fsSL https://raw.githubusercontent.com/your-repo/mtproxy/main/mtproxy.sh)
```

**é»˜è®¤é…ç½®ï¼š**
- ç«¯å£ï¼š443
- ç®¡ç†ç«¯å£ï¼š8888
- ä¼ªè£…åŸŸåï¼šazure.microsoft.com

### ğŸ“ ä½¿ç”¨è¯´æ˜

**åŸºæœ¬ä½¿ç”¨æµç¨‹ï¼š**

1. **é¦–æ¬¡å®‰è£…**ï¼šè¿è¡Œè„šæœ¬é€‰æ‹© `åŠŸèƒ½1` è¿›è¡Œä¸€é”®å®‰è£…å¹¶å¯åŠ¨
2. **è¿›ç¨‹ç¨³å®šæ€§**ï¼šå¦‚æœå‘ç°ä»£ç†åå°è¢«æ€æ­»ï¼Œå»ºè®®å¼€å¯ `åŠŸèƒ½11` åˆ›å»ºsystemdæœåŠ¡
   - systemdæœåŠ¡å¯ç¡®ä¿è¿›ç¨‹è‡ªåŠ¨é‡å¯å’Œå¼€æœºå¯åŠ¨
   - æä¾›æ›´å¼ºçš„è¿›ç¨‹ç¨³å®šæ€§å’Œç³»ç»Ÿçº§ç®¡ç†

**æ¨èé…ç½®é¡ºåºï¼š**
```bash
./mtproxy.sh
# é€‰æ‹© 1 - ä¸€é”®å®‰è£…å¹¶è¿è¡ŒMTProxy
# æµ‹è¯•æ­£å¸¸åï¼Œé€‰æ‹© 11 - åˆ›å»ºsystemdæœåŠ¡ï¼ˆæ¨èï¼‰
```

## ğŸ“‹ åŠŸèƒ½ç‰¹æ€§

### âœ¨ ä¸»è¦åŠŸèƒ½
- ğŸ”„ **è‡ªåŠ¨ç³»ç»Ÿæ£€æµ‹** - è‡ªåŠ¨è¯†åˆ«Linuxå‘è¡Œç‰ˆ
- ğŸŒ **IPv4/IPv6åŒæ ˆæ”¯æŒ** - è‡ªåŠ¨æ£€æµ‹å¹¶ç”Ÿæˆå¯¹åº”é“¾æ¥
- ğŸ›ï¸ **äº¤äº’å¼é…ç½®** - å‹å¥½çš„é…ç½®ç•Œé¢
- ğŸ“Š **çŠ¶æ€ç›‘æ§** - å®æ—¶æŸ¥çœ‹è¿è¡ŒçŠ¶æ€
- ğŸ—‘ï¸ **å®Œæ•´å¸è½½** - å½»åº•æ¸…ç†æ‰€æœ‰æ–‡ä»¶
- ğŸ”§ **è¿›ç¨‹ç¨³å®šæ€§** - è§£å†³è¿›ç¨‹è¢«æ€æ­»é—®é¢˜
- ğŸ“ˆ **å¥åº·æ£€æŸ¥** - å…¨é¢çš„ç³»ç»Ÿå¥åº·è¯„ä¼°
- ğŸš¨ **è‡ªåŠ¨ä¿®å¤** - æ™ºèƒ½é—®é¢˜è¯Šæ–­å’Œä¿®å¤

### ğŸ› ï¸ ç®¡ç†åŠŸèƒ½
- â–¶ï¸ å¯åŠ¨/åœæ­¢/é‡å¯æœåŠ¡
- ğŸ“ˆ æŸ¥çœ‹è¿è¡ŒçŠ¶æ€å’Œä»£ç†ä¿¡æ¯
- ğŸ”§ ç«¯å£é…ç½®ä¿®æ”¹
- ğŸš¨ è¿›ç¨‹ç›‘æ§å’Œè‡ªåŠ¨é‡å¯
- ğŸ¥ ç³»ç»Ÿå¥åº·æ£€æŸ¥
- ğŸ” ç½‘ç»œç¯å¢ƒè¯Šæ–­
- ğŸ› ï¸ è‡ªåŠ¨ä¿®å¤é—®é¢˜
- ğŸ—‘ï¸ å®Œå…¨å¸è½½

### ğŸ”§ é«˜çº§åŠŸèƒ½
- ğŸ“Š **systemdæœåŠ¡æ”¯æŒ** - ç³»ç»Ÿçº§æœåŠ¡ç®¡ç†
- ğŸ”„ **è¿›ç¨‹ç›‘æ§** - è‡ªåŠ¨æ£€æµ‹å’Œé‡å¯
- ğŸ“ **æ—¥å¿—è®°å½•** - å®Œæ•´çš„è¿è¡Œæ—¥å¿—
- ğŸŒ **ç½‘ç»œè¯Šæ–­** - æ™ºèƒ½ç½‘ç»œç¯å¢ƒåˆ†æ
- âš¡ **æ€§èƒ½ä¼˜åŒ–** - ç½‘ç»œè¶…æ—¶ä¼˜åŒ–ï¼ˆ6ç§’ï¼‰

## ğŸ“– ä½¿ç”¨è¯´æ˜

### å®‰è£…åç®¡ç†
å®‰è£…å®Œæˆåï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ç®¡ç†MTProxyï¼š

```bash
# æŸ¥çœ‹çŠ¶æ€å’Œè¿æ¥ä¿¡æ¯
./mtproxy.sh status

# åœæ­¢æœåŠ¡
./mtproxy.sh stop

# å¯åŠ¨æœåŠ¡
./mtproxy.sh start

# é‡å¯æœåŠ¡
./mtproxy.sh restart

# è¿›ç¨‹ç›‘æ§å’Œè‡ªåŠ¨é‡å¯
./mtproxy.sh monitor

# å¥åº·æ£€æŸ¥
./mtproxy.sh health

# ç½‘ç»œç¯å¢ƒè¯Šæ–­
./mtproxy.sh diagnose

# è‡ªåŠ¨ä¿®å¤é—®é¢˜
./mtproxy.sh fix

# åˆ›å»ºsystemdæœåŠ¡
./mtproxy.sh systemd

# å®Œå…¨å¸è½½
./mtproxy.sh uninstall
```

### é…ç½®æ–‡ä»¶
é…ç½®æ–‡ä»¶ä¿å­˜åœ¨ `mtp_config`ï¼ŒåŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼š
- ä»£ç†å¯†é’¥
- ç«¯å£é…ç½®
- ä¼ªè£…åŸŸå
- æ¨å¹¿TAGï¼ˆå¯é€‰ï¼‰

### è¿æ¥ä¿¡æ¯
å®‰è£…å®Œæˆåä¼šæ˜¾ç¤ºï¼š
- æœåŠ¡å™¨IPåœ°å€ï¼ˆIPv4/IPv6ï¼‰
- è¿æ¥ç«¯å£
- ä»£ç†å¯†é’¥
- Telegramè¿æ¥é“¾æ¥

## ğŸ”§ é«˜çº§é…ç½®

### è‡ªå®šä¹‰ç«¯å£
é»˜è®¤ä½¿ç”¨443ç«¯å£ï¼Œå¦‚éœ€ä¿®æ”¹ï¼š
```bash
# ä½¿ç”¨ç«¯å£ä¿®æ”¹åŠŸèƒ½
./mtproxy.sh ports
```

### æ¨å¹¿TAG
å¦‚éœ€ä½¿ç”¨æ¨å¹¿TAGï¼š
1. è”ç³» @MTProxybot è·å–TAG
2. åœ¨é…ç½®é˜¶æ®µè¾“å…¥TAG

### systemdæœåŠ¡ï¼ˆæ¨èï¼‰
åˆ›å»ºç³»ç»Ÿçº§æœåŠ¡ï¼Œç¡®ä¿å¼€æœºè‡ªå¯å’Œè‡ªåŠ¨é‡å¯ï¼š
```bash
# åˆ›å»ºsystemdæœåŠ¡
./mtproxy.sh systemd

# ç®¡ç†æœåŠ¡
systemctl start mtproxy    # å¯åŠ¨
systemctl stop mtproxy     # åœæ­¢
systemctl restart mtproxy  # é‡å¯
systemctl status mtproxy   # çŠ¶æ€
systemctl enable mtproxy   # å¼€æœºè‡ªå¯
```

### è¿›ç¨‹ç›‘æ§
å®æ—¶ç›‘æ§è¿›ç¨‹çŠ¶æ€ï¼Œè‡ªåŠ¨é‡å¯ï¼š
```bash
# å¯åŠ¨ç›‘æ§
./mtproxy.sh monitor

# æˆ–ä½¿ç”¨ç‹¬ç«‹ç›‘æ§è„šæœ¬
./mtproxy_monitor.sh
```

### é˜²ç«å¢™é…ç½®
ç¡®ä¿ä»¥ä¸‹ç«¯å£å¼€æ”¾ï¼š
- ä»£ç†ç«¯å£ï¼ˆé»˜è®¤443ï¼‰
- ç®¡ç†ç«¯å£ï¼ˆé»˜è®¤8888ï¼‰

```bash
# CentOS/RHEL/AlmaLinux
firewall-cmd --permanent --add-port=443/tcp
firewall-cmd --permanent --add-port=8888/tcp
firewall-cmd --reload

# Debian/Ubuntu
ufw allow 443/tcp
ufw allow 8888/tcp

# Alpine Linux
# é€šå¸¸ä¸éœ€è¦é¢å¤–é…ç½®
```

## ğŸ”§ è¿›ç¨‹ç¨³å®šæ€§è§£å†³æ–¹æ¡ˆ

### é—®é¢˜ï¼šMTProxyè¿›ç¨‹ç»å¸¸è¢«æ€æ­»

è¿™æ˜¯ä¸€ä¸ªå¸¸è§é—®é¢˜ï¼Œå¯èƒ½çš„åŸå› åŒ…æ‹¬ï¼š
- ç³»ç»Ÿèµ„æºä¸è¶³ï¼ˆå†…å­˜/CPUï¼‰
- ç³»ç»Ÿé‡å¯åæœªè‡ªåŠ¨å¯åŠ¨
- OOM Killeræ€æ­»è¿›ç¨‹
- ç½‘ç»œç¯å¢ƒå˜åŒ–

### è§£å†³æ–¹æ¡ˆ

#### 1. ä½¿ç”¨è¿›ç¨‹ç›‘æ§ï¼ˆæ¨èï¼‰
```bash
# å¯åŠ¨è¿›ç¨‹ç›‘æ§
./mtproxy.sh monitor
```

#### 2. åˆ›å»ºsystemdæœåŠ¡ï¼ˆæœ€ä½³æ–¹æ¡ˆï¼‰
```bash
# åˆ›å»ºsystemdæœåŠ¡
./mtproxy.sh systemd

# ç®¡ç†æœåŠ¡
systemctl start mtproxy    # å¯åŠ¨
systemctl stop mtproxy     # åœæ­¢
systemctl restart mtproxy  # é‡å¯
systemctl status mtproxy   # çŠ¶æ€
systemctl enable mtproxy   # å¼€æœºè‡ªå¯
```

#### 3. è®¾ç½®å®šæ—¶ä»»åŠ¡
```bash
# ç¼–è¾‘crontab
crontab -e

# æ·»åŠ ä»¥ä¸‹é…ç½®ï¼ˆæ¯5åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡ï¼‰
*/5 * * * * /path/to/mtproxy/mtproxy.sh start
```

#### 4. å¥åº·æ£€æŸ¥
```bash
# å®šæœŸå¥åº·æ£€æŸ¥
./mtproxy.sh health

# æŸ¥çœ‹è¯¦ç»†çŠ¶æ€
./mtproxy.sh check
```

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**1. è¿›ç¨‹ç»å¸¸è¢«æ€æ­»**
```bash
# æ£€æŸ¥ç³»ç»Ÿèµ„æº
free -h
df -h
top

# ä½¿ç”¨ç›‘æ§åŠŸèƒ½
./mtproxy.sh monitor

# åˆ›å»ºsystemdæœåŠ¡
./mtproxy.sh systemd
```

**2. ä¸‹è½½å¤±è´¥**
```bash
# æ£€æŸ¥ç½‘ç»œè¿æ¥
curl -I https://github.com

# ä½¿ç”¨ä»£ç†ä¸‹è½½
export https_proxy=http://your-proxy:port
```

**3. ç«¯å£è¢«å ç”¨**
```bash
# æŸ¥çœ‹ç«¯å£å ç”¨
netstat -tulpn | grep :443

# æ€æ­»å ç”¨è¿›ç¨‹
pkill -f mtg
```

**4. æœåŠ¡å¯åŠ¨å¤±è´¥**
```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯
./mtg run [å‚æ•°] # ä¸åŠ åå°è¿è¡ŒæŸ¥çœ‹é”™è¯¯

# æŸ¥çœ‹æ—¥å¿—
tail -f ./logs/mtproxy.log
```

**5. IPv6ä¸å·¥ä½œ**
```bash
# æ£€æŸ¥IPv6æ”¯æŒ
ping6 google.com
curl -6 ipinfo.io/ip
```

### æ—¥å¿—æŸ¥çœ‹
```bash
# æŸ¥çœ‹è¿›ç¨‹çŠ¶æ€
ps aux | grep mtg

# æŸ¥çœ‹ç«¯å£ç›‘å¬
netstat -tulpn | grep mtg

# æŸ¥çœ‹MTProxyæ—¥å¿—
tail -f ./logs/mtproxy.log
```

### ç³»ç»Ÿèµ„æºä¼˜åŒ–
```bash
# æ£€æŸ¥å†…å­˜ä½¿ç”¨
./mtproxy.sh health

# å¦‚æœå†…å­˜ä¸è¶³ï¼Œè€ƒè™‘ï¼š
# 1. å¢åŠ swapç©ºé—´
# 2. ä¼˜åŒ–ç³»ç»Ÿé…ç½®
# 3. å®šæœŸé‡å¯æœåŠ¡
```

## ğŸ“ æ”¯æŒ

å¦‚é‡é—®é¢˜ï¼Œè¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š
- æ“ä½œç³»ç»Ÿç‰ˆæœ¬ï¼š`cat /etc/os-release`
- ç³»ç»Ÿæ¶æ„ï¼š`uname -m`
- é”™è¯¯ä¿¡æ¯æˆªå›¾
- ç½‘ç»œç¯å¢ƒè¯´æ˜

## ğŸ“„ è®¸å¯è¯

MIT License

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestï¼
